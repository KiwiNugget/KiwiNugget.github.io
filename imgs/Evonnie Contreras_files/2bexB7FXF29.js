/*!CK:3369313652!*//*1430719307,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["y0TRp"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g.createClass({displayName:"SplitImage",render:function(){var l=this.props.size;return (g.createElement("div",g.__spread({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement("div",null,g.createElement("div",{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement("div",null,g.createElement("div",{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement("div",{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("arrayStableSort",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){return h.map(function(j,k){return {data:j,index:k};}).sort(function(j,k){return i(j.data,k.data)||(j.index-k.index);}).map(function(j){return j.data;});}e.exports=g;},null);
__d("RangedCallbackManager",["CallbackManagerController","arrayStableSort","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=k;this.$RangedCallbackManager7=l;this.$RangedCallbackManager8=m;}j.prototype.executeOrEnqueue=function(k,l,m,n,o){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});};j.prototype.unsubscribe=function(k){"use strict";this.$RangedCallbackManager4.unsubscribe(k);};j.prototype.getUnavailableResources=function(k){"use strict";var l=this.$RangedCallbackManager4.getRequest(k),m=[];if(l&&!this.$RangedCallbackManager1){var n=l.request,o=this.$RangedCallbackManager9(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;};j.prototype.addResources=function(k){"use strict";k.forEach(function(l){if(!this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=true;this.$RangedCallbackManager0.push(l);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.addResourcesWithoutSorting=function(k,l){"use strict";var m=this.$RangedCallbackManager0.slice(0,l);m=m.concat(k);m=m.concat(this.$RangedCallbackManager0.slice(l));this.$RangedCallbackManager0=m;Object.assign(this.$RangedCallbackManager3,i(k,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.removeResources=function(k){"use strict";k.forEach(function(l){if(this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=false;var m=this.$RangedCallbackManager0.indexOf(l);if(m!=-1)this.$RangedCallbackManager0.splice(m,1);}}.bind(this));};j.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};j.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=h(this.$RangedCallbackManager0,function(k,l){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(k),this.$RangedCallbackManager6(l));}.bind(this));};j.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};j.prototype.setError=function(k){"use strict";if(this.$RangedCallbackManager2!==k){this.$RangedCallbackManager2=k;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.getError=function(k,l,m){"use strict";var n=this.$RangedCallbackManager9({strict:m});return k+l>n.length?this.$RangedCallbackManager2:null;};j.prototype.hasResource=function(k){"use strict";return this.$RangedCallbackManager3[k];};j.prototype.getResourceAtIndex=function(k){"use strict";return this.$RangedCallbackManager0[k];};j.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};j.prototype.getCurrentArraySize=function(k){"use strict";return this.$RangedCallbackManager9(k).length;};j.prototype.$RangedCallbackManager9=function(k){"use strict";var l=this.$RangedCallbackManager0;if(k&&k.strict){var m=k.skipOnStrictHandler||this.$RangedCallbackManager8;if(m)l=l.filter(m);}return l;};j.prototype.$RangedCallbackManager5=function(k,l){"use strict";var m=this.$RangedCallbackManager9(l);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this.$RangedCallbackManager2:null;return [n,o];}};j.prototype.getElementsUntil=function(k){"use strict";var l=[];for(var m=0;m<this.$RangedCallbackManager0.length;m++){var n=this.$RangedCallbackManager6(this.$RangedCallbackManager0[m]);if(this.$RangedCallbackManager7(n,k)>0)break;l.push(this.$RangedCallbackManager0[m]);}return l;};e.exports=j;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("URLMatcher",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute=q._("Today");v.message_id=v.message_id||j.generateMessageID(v.timestamp);var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,coordinates:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["CurrentUser","MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n){this.$MercuryMessageActions0=n;this.$MercuryMessageActions1=i.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=k.getForFBID(this.$MercuryMessageActions0);}m.prototype.send=function(n,o,p){o=o||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(n,p);o(n.thread_id);};m.prototype.resend=function(n,o){var p=Object.assign({},n);this.$MercuryMessageActions1.normalizeResendMessage(p);this.send(p,(void 0),o);};m.prototype.addAttachmentPlaceholder=function(n,o,p){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(n,o,p);this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));};m.prototype.cancelAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.prototype.confirmAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.addShareDataToExistingMessage=function(n,o,p,q){q=q||g.getID();m.getForFBID(q).addShareDataToExistingMessage(n,o,p);};m.prototype.addShareDataToExistingMessage=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4({server_id:n,attach_key:o,attach_data:p,action_type:h.ADD_SHARE_DATA_TO_EXISTING_MESSAGE},j.SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE));};m.prototype.markSpam=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.MARK_MESSAGES_SPAM,j.CLIENT_MARK_MESSAGES_SPAM));};m.prototype["delete"]=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.DELETE_MESSAGES,p||j.CLIENT_DELETE_MESSAGES));};m.prototype.$MercuryMessageActions3=function(n,o){return {actions:[n],from_client:true,payload_source:o};};m.prototype.$MercuryMessageActions4=function(n,o){return {actions:[n],from_client:false,payload_source:o};};m.prototype.$MercuryMessageActions5=function(n,o,p,q){return {actions:[{action_type:p,action_id:null,thread_id:n,message_ids:o}],from_client:true,payload_source:q};};Object.assign(m,l);e.exports=m;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n){this.$MercuryThreadActions0=n;this.__serverRequests=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,false,o));};m.prototype.markSeen=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.MARK_THREAD_SEEN,h.CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,o));};m.prototype["delete"]=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.__constructClientPayload(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.__serverRequests.unpinThread(n);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.UNPIN_THREAD,h.CLIENT_UNPIN_THREAD));};m.prototype.$MercuryThreadActions1=function(n,o,p){return this.__constructClientPayload(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions2=function(n,o){return this.__constructClientPayload(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("MercuryShareAttachmentSnippet.react",["MercuryShareAttachmentReactShape","MercuryShareStyleMap","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i,k=j.PropTypes,l=i.createClass({displayName:"MercuryShareAttachmentSnippet",propTypes:{attachment:g,isSenderViewer:k.bool,senderName:k.string},render:function(){var m=this.props.attachment;if(!m.style_list)return null;for(var n=0;n<m.style_list.length;n++){var o=h.get(m.style_list[n]);if(o&&!!o.getSnippetComponent){var p=o.getSnippetComponent();return (i.createElement(p,i.__spread({},this.props)));}}return null;}});e.exports=l;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryParticipantFetcher",["MercuryIDs","MercuryPayloadSource","MercuryServerRequests","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(o){this.$MercuryParticipantFetcher0=i.getForFBID(o);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new j();this.$MercuryParticipantFetcher3=new j();}m.prototype.fetch=function(o){this.$MercuryParticipantFetcher4(o);this.$MercuryParticipantFetcher5();};m.prototype.fetchMulti=function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher4(p);}.bind(this));this.$MercuryParticipantFetcher5();};m.prototype.$MercuryParticipantFetcher4=function(o){if(!this.$MercuryParticipantFetcher3.has(o))this.$MercuryParticipantFetcher2.add(o);};m.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;l(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(o){return this.$MercuryParticipantFetcher3.add(o);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher3["delete"](p.id);}.bind(this));this.$MercuryParticipantFetcher7(o);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};m.prototype.$MercuryParticipantFetcher6=function(o,p){var q=[];o.forEach(function(r){var s=g.tokenize(r),t=s.type,u=s.value;t==='fbid'&&q.push(u);});if(q.length>0)k.getMulti(q,function(r){var s=[];for(var t in r)s.push(n(r[t],t));p(s);});};m.prototype.$MercuryParticipantFetcher7=function(o){this.$MercuryParticipantFetcher0.handleUpdate({participants:o,from_client:false,payload_source:h.SERVER_FETCH_PARTICIPANTS});};function n(o,p){var q=Object.assign({gender:o.gender,href:o.uri,id:g.getParticipantIDFromUserID(o.id||p),image_src:o.thumbSrc,name:o.name,short_name:o.firstName,employee:o.employee,is_employee_away:o.is_employee_away,type:o.type,vanity:o.vanity,is_friend:o.is_friend,is_messenger_user:o.is_messenger_user,orion_eligible:o.orionEligible,social_snippets:o.social_snippets},{});if(o.officeStatus){q.officeStatus=o.officeStatus;q.officeStatusStartDate=o.officeStatusStartDate;q.officeStatusEndDate=o.officeStatusEndDate;q.officeStatusComment=o.officeStatusComment;q.officeStatusLocation=o.officeStatusLocation;}return q;}e.exports=m;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","Map","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryServerRequests","PhotoResizeModeConst","Set","fbt","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new p(this.$MercuryParticipants0);this.$MercuryParticipants4=new m();this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants5.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0){var da={};ca.participants.forEach(function(ea){da[ea.id]=ea;});this.$MercuryParticipants6(da);}}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return;if(this.$MercuryParticipants4.has(aa))return this.$MercuryParticipants4.get(aa);if(/^\d+$/.test(aa))return o.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants7(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants7(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){n.isParticipantID(aa);return this.$MercuryParticipants8([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants8(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){n.allParticipantIDs(aa);var ca=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants9(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(o.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants8=function(aa,ba){n.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=o.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipantsa(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsb(ca);};y.prototype.$MercuryParticipants7=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=o.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipantsa(aa,ea);}return ba;};y.prototype.$MercuryParticipantsa=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants9=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants6=function(aa){aa=w(aa,function(ba,ca){if(ba.vanity)this.$MercuryParticipants4.set(ba.vanity,ca);return new k(this.$MercuryParticipantsc(ba));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(aa);this.$MercuryParticipants9(new u(Object.keys(aa)));};y.prototype.$MercuryParticipantsc=function(aa){var ba=aa.type===q.USER||aa.type===q.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca=v._("Facebook User");aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsb=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:r.UNKNOWN_GENDER,href:null,id:aa,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentSnippetRenderer","MercuryAttachmentSnippetType","MercuryAttachmentType","MercuryIDs","P2PMercuryAttachmentSnippet.react","MercuryShareAttachmentSnippet.react","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();'use strict';var w=q,x=w.PropTypes,y=q.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:x.object.isRequired,viewer:x.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(ba){this._ensureParticipant(ba.thread.snippet_sender);this._setVariables(ba);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var ba=this._getSenderName(),ca=j.getAttachmentSnippetType(this._attachments);switch(ca){case k.PHOTO:return this._renderPhotoSnippet(ba);case k.GIF:return this._renderAnimatedImageSnippet(ba);case k.VIDEO:return this._renderVideoSnippet(ba);case k.AUDIO_CLIP:return this._renderAudioClipSnippet(ba);case k.STICKER:return this._renderStickerSnippet(ba);case k.ORION:return this._renderOrionSnippet(ba);case k.SHARE:return this._renderShareSnippet(ba);case k.ERROR:return this._renderError(ba);default:return this._renderMixedSnippet(ba);}},_renderPhotoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.PHOTO,this._isViewerSender,ba,this._attachments));},_renderAnimatedImageSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.GIF,this._isViewerSender,ba,this._attachments));},_renderVideoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.VIDEO,this._isViewerSender,ba));},_renderAudioClipSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.AUDIO_CLIP,this._isViewerSender,ba));},_renderStickerSnippet:function(ba){if(z(this._attachments[0].metadata.stickerID)){return (q.createElement(s,{renderEmoticons:true,text:g.symbols.like}));}else return (q.createElement("span",null,j.renderAttachmentSnippetText(k.STICKER,this._isViewerSender,ba)));},_renderOrionSnippet:function(ba){return (q.createElement("span",null,q.createElement(n,q.__spread({},this._attachments[0].metadata))));},_renderShareSnippet:function(ba){if(!!this._attachments[0].share)return (q.createElement(o,{attachment:this._attachments[0].share,senderName:ba,isViewerSender:this._isViewerSender}));return this._renderSnippet(j.renderAttachmentSnippetText(k.SHARE,this._isViewerSender,ba));},_renderMixedSnippet:function(ba){return (q.createElement("span",null,this._attachments.filter(function(ca){return ca.attach_type===l.FILE||ca.attach_type===l.PHOTO||ca.attach_type===l.VIDEO;}).map(function(ca,da){return this._renderSnippet(ca.name,ca.icon_type,da);}.bind(this))));},_renderSnippet:function(ba,ca,da){var ea=i.getAttachIconClass(ca||this._attachments[0].icon_type),fa=v(ea,"uiIconText _3l6h");return (q.createElement("span",{className:fa,key:da},q.createElement(h,{src:u('/images/messaging/docs/generic.png')}),ba));},_renderError:function(ba){var ca=j.renderAttachmentSnippetText(k.ERROR,this._isViewerSender,ba);return this._renderSnippet(ca);},_setVariables:function(ba){this._viewer=ba.viewer;this._sender=ba.thread.snippet_sender;this._attachments=ba.thread.snippet_attachments;this._isViewerSender=aa(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var ba=p.getNow(this._sender);if(!ba)return null;return ba.short_name;},_ensureParticipant:function(ba){if(!ba)return;this._cancelParticipantFetch();if(!p.getNow(ba))this._sub=p.get(ba,function(ca){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function z(ba){return (ba==r.LIKE_STICKER_ID||ba==r.HOT_LIKE_SMALL_STICKER_ID||ba==r.HOT_LIKE_MEDIUM_STICKER_ID||ba==r.HOT_LIKE_LARGE_STICKER_ID);}function aa(ba,ca){return !!(ba&&m.getParticipantIDFromUserID(ca)==ba);}e.exports=y;},null);
__d("MercuryParticipantsImage.react",["MercuryParticipants","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h,l=k.PropTypes,m=h.createClass({displayName:"MercuryParticipantsImage",_bigImageToken:(null),propTypes:{participants:l.array.isRequired,size:l.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(n){this._getParticipantImages(n);},componentWillUnmount:function(){this._bigImageToken&&this._bigImageToken.remove();},shouldComponentUpdate:function(n,o){return (n.size!==this.props.size||!o||!j(o.participantImages,this.state.participantImages));},render:function(){if(this.state.participantImages.length>0)return (h.createElement(i,{border:true,className:this.props.className,srcs:this.state.participantImages,size:this.props.size}));return null;},_getParticipantImages:function(n){this._bigImageToken&&this._bigImageToken.remove();(this)._bigImageToken=g.getOrderedBigImageMulti(n.participants,function(o){this.isMounted()&&this.setState({participantImages:o});}.bind(this));}});e.exports=m;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipantsImage.react","MercuryParticipantsConstants","Pixelz.react","React","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=l,o=n.PropTypes,p=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:o.instanceOf(g).isRequired,viewer:o.string.isRequired,size:o.number,useBackground:o.bool},shouldComponentUpdate:function(q,r){return (q.thread.image_src!==this.props.thread.image_src||!m(q.thread.participants,this.props.thread.participants)||q.size!==this.props.size||q.viewer!==this.props.viewer||q.useBackground!==this.props.useBackground);},render:function(){var q=this.props.size||j.BIG_IMAGE_SIZE,r=this.props.thread.image_src;if(r){if(this.props.useBackground)return (l.createElement("div",{style:{height:q,backgroundImage:("url("+r+")"),backgroundPosition:'50% 50%',backgroundRepeat:'no-repeat',backgroundSize:'cover',width:q}}));return (l.createElement(k,{height:q,resizeMode:'cover',src:r,width:q}));}var s=h.getParticipantIDFromUserID(this.props.viewer),t=this.props.thread.participants.filter(function(v){return v!==s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);return (l.createElement(i,{participants:u,size:q}));}});e.exports=p;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return (g._("New Message"));}else return (g._("No Participants"));}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._({"*":"{others_count} others"},[g.param("others_count",r,[0])]));}else return (g._("1 other"));}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=g.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});i.getMulti(r,function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=(p.showUnreadCount&&p.thread.unread_count)?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}.bind(this));},_renderTitleWithUnreadCount:function(p,q){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",p),l.param("unread-count",q)]));}});e.exports=o;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryThreadInfo",["CurrentUser","MercuryThreadMode"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={canReply:function(k){return !!(k.is_subscribed&&k.mode!=h.OBJECT_ORIGINATED&&!k.has_email_participant&&!k.read_only&&(k.recipients_loadable||k.recipients_loadable===(void 0)));},getMuteSetting:function(k){return (k.mute_settings&&k.mute_settings[j(g.getID())]);},isMuted:function(k){return i.getMuteSetting(k)!==(void 0);}};function j(k){return k+'@facebook.com';}e.exports=i;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","EventEmitter","ImmutableObject","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachmentType","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","URI","copyProperties","debounceAcrossTransitions","invariant","isMessengerDotComURI","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){b.__markCompiled&&b.__markCompiled();'use strict';var ja=new j(),ka=l.getInstance('mercury_messages');function la(xa,ya){var za=ya;if(xa._localIdsMap[ya])za=xa._localIdsMap[ya];return xa._messages.get(za);}function ma(xa){switch(xa){case t.UNKNOWN:case t.SERVER_INITIAL_DATA:case t.SERVER_FETCH_THREAD_INFO:case t.SERVER_THREAD_SYNC:return true;}return false;}function na(xa,ya){if(!xa._threadsToMessages[ya])xa._threadsToMessages[ya]=new x(function(za){return la(xa,za).timestamp;},function(za,ab){return ab-za;});return xa._threadsToMessages[ya];}function oa(xa,ya,za){ya.forEach(function(ab){var bb=na(xa,ab);bb.setReachedEndOfArray();xa._emitReorderedChange(ab,za);});}function pa(xa){this._fbid=xa;this._messageActions=v.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new m();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(ya,za){var ab=(za.actions||[]).filter(function(cb){var db=cb.action_type,eb=((cb.is_forward||cb.thread_id)&&(db==o.LOG_MESSAGE||db==o.USER_GENERATED_MESSAGE||db==o.SEND_MESSAGE||db==o.DELETE_THREAD||db==o.DELETE_MESSAGES||db==o.MARK_MESSAGES_SPAM)),fb=((cb.upload_id&&cb.upload_data)&&(db==o.CANCEL_ATTACHMENT_PLACEHOLDER||db==o.CONFIRM_ATTACHMENT_PLACEHOLDER)),gb=(db==o.ADD_SHARE_DATA_TO_EXISTING_MESSAGE&&(cb.server_id&&cb.attach_key&&cb.attach_data));return (eb||fb||gb);}),bb=ma(za.payload_source);this.handleUpdates(ab,bb,za.payload_source,za.from_client);if(za.end_of_history)oa(this,za.end_of_history,za.payload_source);if(this._didChange){this._didChange=false;ja.emit('change');}}.bind(this));ka.debug('constructed',{fbid:this._fbid});}ea(pa.prototype,{getMessagesFromIDs:function(xa){return (xa||[]).map(la.bind(null,this)).filter(function(ya){return ya;});},hasLoadedNMessages:function(xa,ya){var za=na(this,xa);return za.hasReachedEndOfArray()||za.getCurrentArraySize()>=ya;},hasLoadedExactlyNMessages:function(xa,ya){var za=na(this,xa);return za.getCurrentArraySize()==ya;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new m();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(xa,ya,za,ab,bb,cb){var db=na(this,xa),eb=function(mb){ab(qa(this,mb));}.bind(this),fb=db.executeOrEnqueue(ya,za,eb),gb=db.getUnavailableResources(fb),hb=this._failedHistoryFetchThreads[xa];if(gb.length&&!hb){var ib=db.getCurrentArraySize(),jb=this._localTitanMessagesCount[xa]||0,kb=ib-jb,lb=gb.length+jb;ka.debug('fetch_missing_messages',{threadID:xa,offset:ya,limit:za,missingIndices:gb,messageCount:ib,localMessageCount:jb});this._serverRequests.fetchThreadMessages(xa,kb,lb,bb,cb);}else this._failedHistoryFetchThreads[xa]=false;return fb;},getThreadMessagesRangeNow:function(xa,ya,za){var ab=na(this,xa),bb=[];for(var cb=ya;cb<ya+za;cb++){var db=ab.getResourceAtIndex(cb),eb=la(this,db);eb&&bb.push(eb);}return bb;},getThreadMessagesSinceTimestamp:function(xa,ya){var za=na(this,xa),ab=za.getElementsUntil(ya);return qa(this,ab);},hasLoadedAllMessages:function(xa){return na(this,xa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(xa){var ya=na(this,xa).getAllResources();return qa(this,ya);},unsubscribe:function(xa,ya){p.isThreadID(ya);var za=na(this,ya);za.unsubscribe(xa);},_addNewMessage:function(xa,ya){ta(this,ya);ua(ya);this._messages.set(xa,new k(ya));},_updateMessage:function(xa,ya,za){var ab=k.set(ya,za);this._messages.set(xa,ab);return ab;},_addAttachmentData:function(xa,ya,za){var ab=la(this,xa);if(ab){var bb=ab.attachments.indexOf(ya);if(bb!=-1){this._updateMessage(xa,ab,{attachments:ab.attachments.map(function(cb,db){return (db===bb)?za:cb;})});this._emitUpdatedChange(ab.thread_id,ab.message_id,'attach');}}else{if(!this._attachmentData[xa])this._attachmentData[xa]=[];this._attachmentData[xa].push({attach_key:ya,data:za});}},_shouldSortOutOfOrderMessages:function(xa,ya,za){if(xa==t.CLIENT_CHANNEL_MESSAGE){var ab=this.getThreadMessagesSinceTimestamp(ya,za);if(ab.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(xa,ya){var za=xa.action_type;if(ya==t.CLIENT_CHANNEL_MESSAGE&&za==o.USER_GENERATED_MESSAGE&&xa.threading_id&&this._localIdsMap[xa.threading_id]===xa.threading_id){xa.client_message_id=xa.threading_id;xa.status=n.SUCCESS;xa.action_type=o.SEND_MESSAGE;za=xa.action_type;}if(ya===t.CLIENT_CHANNEL_MESSAGE&&za==o.USER_GENERATED_MESSAGE){var ab=this._threads.getThreadMetaNow(xa.thread_id);if(ab&&ab.folder)xa.folder=ab.folder;}return xa;},handleUpdates:function(xa,ya,za,ab){var bb,cb={},db={};for(var eb=0;eb<xa.length;eb++){var fb=this._preprocessIncomingAction(xa[eb],za),gb=fb.action_type,hb=la(this,fb.message_id);if(fb.is_forward||za==t.SERVER_SEARCH){if(!this._messages.has(fb.message_id))this._addNewMessage(fb.message_id,fb);continue;}else if(fb.client_state===s.SEND_TO_SERVER){this._addNewMessage(fb.message_id,fb);continue;}else if(gb==o.SEND_MESSAGE){var ib=fb.client_message_id;if(ib&&this._localIdsMap[ib]&&fb.status){var jb=la(this,ib),kb=jb.status;if(jb.status==n.SUCCESS)continue;if(fb.status==n.UNCONFIRMED){if(!db[fb.thread_id])db[fb.thread_id]=[];db[fb.thread_id].push(ib);}else if(!cb[fb.thread_id])cb[fb.thread_id]=[];this._updateLocalMessage(fb);if(typeof kb!==(void 0)||fb.status==n.FAILED_UNKNOWN_REASON||fb.status==n.UNABLE_TO_CONFIRM||fb.status==n.SUCCESS||fb.status==n.ERROR)this._emitUpdatedChange(fb.thread_id,la(this,ib).message_id,za);}continue;}else if(gb==o.DELETE_THREAD){na(this,fb.thread_id).removeAllResources();continue;}else if(gb==o.DELETE_MESSAGES){this._deleteMessages(fb.thread_id,fb.message_ids,za);continue;}else if(gb===o.MARK_MESSAGES_SPAM){this._markMessagesSpam(fb,za);continue;}else if((fb.threading_id&&this._localIdsMap[fb.threading_id])||(hb&&!hb.is_forward)){if(hb&&fb.ranges&&fb.ranges.length>0){var lb=hb.message_id;this._updateMessage(this._localIdsMap[lb]||lb,hb,{ranges:xa.ranges});this._emitUpdatedChange(hb.thread_id,hb.message_id,'link_shim');}continue;}else if(gb===o.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(fb.upload_id,fb.upload_data);continue;}else if(gb===o.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(fb.upload_id,fb.upload_data);continue;}else if(gb===o.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){this._addAttachmentData(fb.server_id,fb.attach_key,fb.attach_data);continue;}else{if(za===t.CLIENT_SEND_MESSAGE){this._localIdsMap[fb.message_id]=fb.message_id;if(fb.thread_id=='root:'+fb.message_id)na(this,fb.thread_id).setReachedEndOfArray();}if(gb==o.LOG_MESSAGE&&fb.log_message_type==r.SERVER_ERROR)this._failedHistoryFetchThreads[fb.thread_id]=true;if(fb.client_state===s.DO_NOT_SEND_TO_SERVER&&fb.upload_id)this._uploadMessages[fb.upload_id]=fb;if(!cb[fb.thread_id])cb[fb.thread_id]=[];cb[fb.thread_id].push(fb.message_id);this._addNewMessage(fb.message_id,fb);if(fb.threading_id&&fb.threading_id!=fb.message_id)w.addServerID(fb.threading_id,fb.message_id);if(fb[y.MANUAL_RETRY_CNT]>0){bb=na(this,fb.thread_id);bb.resortResources([fb.message_id]);this._emitReorderedChange(fb.thread_id,t.CLIENT_SEND_MESSAGE);}ya=ya||this._shouldSortOutOfOrderMessages(za,fb.thread_id,fb.timestamp);if(!ya)this._emitReceivedChange(la(this,fb.message_id));continue;}}for(var mb in cb){bb=na(this,mb);var nb=bb.getAllResources(),ob=nb.filter(function(qb){var rb=this._messages.get(qb);return rb.action_type==o.LOG_MESSAGE&&rb.log_message_type==r.SERVER_ERROR;}.bind(this));bb.removeResources(ob);if(ab)ra(this,mb,cb[mb]);if(ya){bb.addResources(cb[mb]);this._emitReorderedChange(mb,za);}else bb.addResourcesWithoutSorting(cb[mb].reverse(),0);this._threadInformer.updatedThread(mb);}var pb=Object.keys(db);if(pb.length)this._serverRequests.requestMessageConfirmation(db);ka.debug('handle_updates',{localMessageCounts:ia(this._localTitanMessagesCount)});},isFirstMessage:function(xa){var ya=na(this,xa.thread_id);if(ya.getCurrentArraySize()===0)return false;var za=ya.getResourceAtIndex(ya.getCurrentArraySize()-1),ab=la(this,za).message_id,bb=la(this,xa.message_id).message_id;return ya.hasReachedEndOfArray()&&ab==bb;},_markMessagesSpam:function(xa,ya){var za=xa,ab=za.thread_id,bb=za.message_ids;if(!bb.length)return;this._deleteIndividualMessages(ab,bb,ya);this._serverRequests.markMessagesSpam(ab,bb);},_deleteMessages:function(xa,ya,za){if(!ya.length)return;this._deleteIndividualMessages(xa,ya,za);if(za!==t.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(xa,ya);},_deleteIndividualMessages:function(xa,ya,za){var ab=ya.map(function(cb){return la(this,cb).message_id;},this),bb=na(this,xa);bb.removeResources(ab);this._emitReorderedChange(xa,za);},_updateLocalMessage:function(xa){var ya=la(this,xa.client_message_id),za={};za.status=xa.status;if(xa.status===n.SUCCESS||xa.error_data)za.error_data=xa.error_data;var ab=xa.message_id,bb=xa.client_message_id;if(this._messages.has(ab)){this._updateMessage(ab,ya,za);return false;}if(xa.timestamp)za.timestamp=xa.timestamp;if(xa.log_message_data)za.log_message_data=xa.log_message_data;if(xa.ranges&&xa.ranges.length){ua(xa);za.ranges=xa.ranges;}if(xa.attachments&&xa.attachments.length){za.raw_attachments=null;za.attachments=xa.attachments;ta(this,za,ab);}this._localIdsMap[bb]=ab;w.addServerID(bb,ab);var cb=this._updateMessage(ab,ya,za);this._messages.set(bb,new k());if(sa(cb))this._localTitanMessagesCount[cb.thread_id]--;return true;},getNumberLocalMessages:function(xa){return this._localTitanMessagesCount[xa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(xa,ya){var za=this._popPendingAttachmentMessage(xa,ya);this._serverRequests.sendNewMessage(za);},_cancelAttachmentPlaceholder:function(xa,ya){var za=this._popPendingAttachmentMessage(xa,ya);this._deleteIndividualMessages(za.thread_id,[za.message_id]);if(this._localTitanMessagesCount[za.thread_id])this._localTitanMessagesCount[za.thread_id]--;},_popPendingAttachmentMessage:function(xa,ya){var za=this._uploadMessages[xa];ga(za);za.image_ids=ya.image_ids;za.file_ids=ya.file_ids;za.audio_ids=ya.audio_ids;za.gif_ids=ya.gif_ids;za.client_state=s.SEND_TO_SERVER;delete this._uploadMessages[xa];return za;},_emitUpdatedChange:function(xa,ya,za){this._didChange=true;this._threadInformer.updatedMessage(xa,ya,za);},_emitReceivedChange:function(xa){this._didChange=true;this._threadInformer.receivedMessage(xa);},_emitReorderedChange:function(xa,ya){this._didChange=true;this._threadInformer.reorderedMessages(xa,ya);}});Object.assign(pa,u,{addListener:function(xa,ya){return ja.addListener(xa,ya);}});function qa(xa,ya){var za=ya.map(la.bind(null,xa));return za.reverse();}function ra(xa,ya,za){var ab=za.filter(function(bb){return sa(la(xa,bb));});if(!xa._localTitanMessagesCount[ya])xa._localTitanMessagesCount[ya]=0;xa._localTitanMessagesCount[ya]+=ab.length;}function sa(xa){var ya=xa.action_type;if(ya==o.USER_GENERATED_MESSAGE)return true;switch(xa.log_message_type){case r.SUBSCRIBE:case r.UNSUBSCRIBE:case r.SERVER_ERROR:case r.LIVE_LISTEN:return false;default:return true;}}function ta(xa,ya,za){za=za||ya.message_id;var ab=xa._attachmentData[za];if(ab){ab.forEach(function(bb){var cb=ya.attachments.indexOf(bb.attach_key);if(cb!==-1)ya.attachments[cb]=bb.data;});delete xa._attachmentData[za];}else if(!ya.is_forward&&va(xa,ya)){xa._messagesNeedingAttachmentData[za]=true;wa(xa);}}function ua(xa){if(!xa.ranges)return;xa.ranges.forEach(function(ya){if(!ya.entity||ya.entity.external||!ya.entity.url)return;var za=new da(ya.entity.url);if(ha(da.getRequestURI())&&!za.getDomain()){za.setProtocol('https').setDomain('www.facebook.com');ya.entity.url=za.toString();}});}function va(xa,ya){if(!ya||!ya.attachments)return false;for(var za=0;za<ya.attachments.length;za++){var ab=ya.attachments[za];if(typeof ab==='string'&&ab.indexOf(q.SHARE)===0)return true;}var bb=ya.forward_message_ids||[];for(za=0;za<bb.length;za++){var cb=la(xa,bb[za]);if(va(xa,cb))return true;}return false;}var wa=fa(function(xa){var ya={};for(var za in xa._messagesNeedingAttachmentData){var ab=la(xa,za);if(va(xa,ab))ya[za]=true;}var bb=Object.keys(ya);if(bb.length){var cb={message_ids:bb};if(xa._fbid!=i.getID())cb.request_user_id=xa._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(cb).setAllowCrossPageTransition(true).send();}xa._messagesNeedingAttachmentData={};},0,this);e.exports=pa;},null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i='fbid:'+g.getID(),j={getID:function(){return i;},isViewer:function(k){h.isParticipantID(k);return k===i;}};e.exports=j;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.__serverRequests=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler1=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler4=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler6(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler6=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.__serverRequests.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.__serverRequests.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlera(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerb(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerd(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.__serverRequests.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj)return;this.$MercuryChannelHandler1.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerf=function(aa,ba){"use strict";this.__serverRequests.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.__serverRequests.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler4(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler6(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandler9(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler7(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler8(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerc(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerb(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerf(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerg(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler5=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlerd=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler3.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler3.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler3.length){this.$MercuryChannelHandler3.forEach(g.unsubscribe);this.$MercuryChannelHandler3=[];}return this;};u(z,n);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","mapObject","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o={},p=[],q=k.SUCCESS,r={getSeenBy:function(u,v){if(!u)return [];var w=[],x=o[u.thread_id];if(!x)return w;x.forEach(function(y,z){if(s(u,y,z,v))w.push(z);});return w;},wasSeenByAll:function(u){if(!u)return false;var v=o[u.thread_id];if(!v)return false;return v.every(function(w,x){return s(u,w,x);});},getSeenTimestamps:function(u){var v=o[u];if(!v){v=i.OrderedMap();o[u]=v;}return v;},getSeenTimestamp:function(u,v){var w=o[u];return w?w.get(v):null;}};Object.assign(r,h);function s(u,v,w,x){return !!(v>u.timestamp&&(u.status===(void 0)||u.status===q)&&(!x||w!=u.author));}m.subscribe('update-roger',function(u,v){for(var w in v){var x=o[w]||i.OrderedMap();x=x.withMutations(function(y){for(var z in v[w]){var aa=n.getThreadMetaNow(w);if(aa&&aa.participants)if(aa.participants.indexOf(z)==-1){p.push(t(o));continue;}var ba=y.get(z),ca=v[w][z];if(!ba||ca>ba)y.set(z,ca);}});o[w]=x.sort();}v&&r.inform('change',v);});g.subscribe(j.DUMP_EVENT,function(u,v){v.bad_read_receipts={receipts:p};});function t(u){return l(u,function(v){return v.toJS();});}e.exports=r;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryMessages').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(y,z){if(q[y])return [];return k.getSeenBy(t(y),z);},wasSeenByAll:function(y){if(q[y])return false;return k.wasSeenByAll(t(y));}};Object.assign(s,g);function t(y){if(!p[y]){var z=o.getThreadMetaNow(y);if(z)p[y]={thread_id:y,author:z.participants[0],timestamp:z.timestamp};}return p[y];}function u(y){var z=false;m.getThreadMessagesRange(y,0,1,function(aa){var ba=aa[0];if(!ba)return;var ca=ba.timestamp;if(ba.action_id||ba.status==i.SUCCESS)ca-=h.getServerTimeOffset();var da=s.getSeenBy(y);if(q[y]){clearTimeout(q[y]);delete q[y];}var ea=ca+r,fa=ea-Date.now();if(fa>0)q[y]=l(function(){delete q[y];v(y);},fa);p[y]=ba;var ga=s.getSeenBy(y);if(da.length||ga.length)z=true;});return z;}function v(y){var z={};z[y]=true;w(z);}function w(y){s.inform('state-changed',y);s.inform('change');}function x(event,y){var z={};for(var aa in y)if(u(aa))z[aa]=true;for(var ba in z){w(z);break;}}k.subscribe('change',function(y,z){for(var aa in z)!q[aa]&&v(aa);});n.subscribe('messages-received',x);n.subscribe('messages-reordered',x);n.subscribe('messages-updated',x);e.exports=s;},null);